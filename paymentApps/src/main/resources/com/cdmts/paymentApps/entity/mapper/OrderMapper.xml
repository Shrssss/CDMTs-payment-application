<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cdmts.paymentApps.entity.mapper.OrderMapper">

    <!-- ORDERマップ -->
    <resultMap id="orderMap" type="com.cdmts.paymentApps.entity.OrderTable">
        <id column="ORDERID" property="orderId"/>
        <result column="ORDER_DATE" property="orderDate"/>
        <result column="RESERVED_TIME" property="reservedTime"/>
        <result column="SERVING_STATUS" property="servingStatus"/>
        <result column="PAYMENTID" property="paymentId"/>
        <result column="PAYMENT_STATUS" property="paymentStatus"/>
    </resultMap>

    <!-- ORDER_ITEMマップ -->
    <resultMap id="orderItemMap" type="com.cdmts.paymentApps.entity.OrderItemTable">
        <id column="ORDER_ITEM_ID" property="orderItemId"/>
        <result column="ORDERID" property="orderId"/>
        <result column="ITEMID" property="itemId"/>
        <result column="QUANTITY" property="quantity"/>
    </resultMap>

    <!-- ITEMマップ -->
    <resultMap id="itemMap" type="com.cdmts.paymentApps.model.Item">
        <id column="ITEMID" property="itemId"/>
        <result column="ITEM_NAME" property="itemName"/>
        <result column="PRICE" property="price"/>
        <result column="AVAILABLE" property="available"/>
    </resultMap>



    <select id="selectOrdersByOrderId" resultMap="orderMap" parameterType="int">
        SELECT ORDERID, ORDER_DATE, RESERVED_TIME, SERVING_STATUS, PAYMENTID, PAYMENT_STATUS
        FROM ORDER_TABLE
        WHERE ORDERID = #{orderId}
    </select>

    <select id="selectOrderItemsByOrderId" resultMap="orderItemMap" parameterType="int">
        SELECT ORDER_ITEM_ID, ORDERID, ITEMID, QUANTITY
        FROM ORDER_ITEM_TABLE
        WHERE ORDERID = #{orderId}
    </select>

    <select id="selectItemByItemId" resultMap="itemMap" parameterType="int">
        SELECT ITEMID, ITEM_NAME, PRICE, AVAILABLE
        FROM ITEM_TABLE
        WHERE ITEMID = #{itemId}
    </select>

    <select id="selectAllOrders" resultMap="orderMap">
        SELECT ORDERID, ORDER_DATE, RESERVED_TIME, SERVING_STATUS, PAYMENTID, PAYMENT_STATUS
        FROM ORDER_TABLE
    </select>

    <select id="selectAllItems" resultMap="itemMap">
        SELECT ITEMID, ITEM_NAME, PRICE, AVAILABLE
        FROM ITEM_TABLE
    </select>

    <select id="selectServingStatusByOrderId" resultType="int" parameterType="int">
        SELECT SERVING_STATUS
        FROM ORDER_TABLE
        WHERE ORDERID = #{orderId}
    </select>

    <select id="selectOrdersByServingStatus" resultMap="orderMap" parameterType="int">
        SELECT ORDERID, ORDER_DATE, RESERVED_TIME, SERVING_STATUS, PAYMENTID, PAYMENT_STATUS
        FROM ORDER_TABLE
        WHERE SERVING_STATUS = #{servingStatus}
    </select>



    <insert id="insertOrder" parameterType="com.cdmts.paymentApps.entity.OrderTable" useGeneratedKeys="true" keyProperty="orderId">
        INSERT INTO ORDER_TABLE (ORDER_DATE, RESERVED_TIME, SERVING_STATUS, PAYMENTID, PAYMENT_STATUS)
        VALUES (#{orderDate}, #{reservedTime}, #{servingStatus}, #{paymentId}, #{paymentStatus})
    </insert>

    <insert id="insertOrderItem" parameterType="com.cdmts.paymentApps.entity.OrderItemTable" useGeneratedKeys="true" keyProperty="orderItemId">
        INSERT INTO ORDER_ITEM_TABLE (ITEMID, ORDERID, QUANTITY)
        VALUES (#{itemId}, #{orderId}, #{quantity})
    </insert>

    <insert id="insertItem" parameterType="com.cdmts.paymentApps.model.Item">
        INSERT INTO ITEM_TABLE (ITEMID, ITEM_NAME, PRICE, AVAILABLE)
        VALUES (#{itemId}, #{itemName}, #{price}, #{available})
    </insert>

    <update id="updateItemAvailabilityByItemId" parameterType="com.cdmts.paymentApps.model.Item">
        UPDATE ITEM_TABLE
        SET AVAILABLE = #{available}
        WHERE ITEMID = #{itemId}
    </update>



    <update id="updateServingStatusByOrderId" parameterType="com.cdmts.paymentApps.entity.OrderTable">
        UPDATE ORDER_TABLE
        SET SERVING_STATUS = #{servingStatus}
        WHERE ORDERID = #{orderId}
    </update>

    <update id="updatePaymentStatusByOrderId" parameterType="com.cdmts.paymentApps.entity.OrderTable">
        UPDATE ORDER_TABLE
        SET PAYMENT_STATUS = #{paymentStatus}
        WHERE ORDERID = #{orderId}
    </update>
    
    <update id="updatePaymentIdByOrderId" parameterType="com.cdmts.paymentApps.entity.OrderTable">
    	UPDATE ORDER_TABLE
   		SET PAYMENTID = #{paymentId}
   		WHERE ORDERID = #{orderId}
    </update>
    

</mapper>
